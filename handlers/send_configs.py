import os
from aiogram import types
from aiogram.types import FSInputFile
from loader import dp, bot
from utils.db_utils import get_user_by_id
from utils.messages_manage import non_authorized

# –¢–µ–∫—Å—Ç—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π VPN —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
config_texts = {
    "az_ut_ovpn": {
        "prefix": "AZ-U+T",
        "text": "üåç –ò–¥–µ–∞–ª—å–Ω–æ–µ —Å–æ—á–µ—Ç–∞–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏! –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è <b>–æ–±–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞</b> –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –≥–∏–±–∫–æ—Å—Ç–∏ ‚ú®\n\n<b>FAQ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Ñ–∞–π–ª–æ–≤:</b>\n\n <code>&lt;–≤–∞—Ä–∏–∞–Ω—Ç_–≤–ø–Ω&gt;-&lt;–ø—Ä–æ—Ç–æ–∫–æ–ª&gt;-&lt;–¥–∞—Ç–∞_–∞–∫—Ç–∏–≤–∞—Ü–∏–∏–Ω&gt;.*</code>",
    },
    "az_u_ovpn": {
        "prefix": "AZ-UDP",
        "text": "‚ö° <b>–í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</b>. –ò–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤–æ–≥–æ –≤–∏–¥–µ–æ –∏ –∏–≥—Ä! üéÆ \n\n<b>FAQ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Ñ–∞–π–ª–æ–≤:</b>\n\n <code>&lt;–≤–∞—Ä–∏–∞–Ω—Ç_–≤–ø–Ω&gt;-&lt;–ø—Ä–æ—Ç–æ–∫–æ–ª&gt;-&lt;–¥–∞—Ç–∞_–∞–∫—Ç–∏–≤–∞—Ü–∏–∏–Ω&gt;.*</code>",
    },
    "az_t_ovpn": {
        "prefix": "AZ-TCP",
        "text": "üîí <b>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</b>. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –æ–±—Ö–æ–¥–∞ —Å—Ç—Ä–æ–≥–∏—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –∏ –∑–∞—â–∏—Ç—ã –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏. üîë\n\n<b>FAQ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Ñ–∞–π–ª–æ–≤:</b>\n\n <code>&lt;–≤–∞—Ä–∏–∞–Ω—Ç_–≤–ø–Ω&gt;-&lt;–ø—Ä–æ—Ç–æ–∫–æ–ª&gt;-&lt;–¥–∞—Ç–∞_–∞–∫—Ç–∏–≤–∞—Ü–∏–∏–Ω&gt;.*</code>",
    },
    "gb_ut_ovpn": {
        "prefix": "GL-U+T",
        "text": "üåç –ò–¥–µ–∞–ª—å–Ω–æ–µ —Å–æ—á–µ—Ç–∞–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ <b>–æ–±–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞</b> –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –≥–∏–±–∫–æ—Å—Ç–∏ ‚ú®\n\n<b>FAQ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Ñ–∞–π–ª–æ–≤:</b>\n\n <code>&lt;–≤–∞—Ä–∏–∞–Ω—Ç_–≤–ø–Ω&gt;-&lt;–ø—Ä–æ—Ç–æ–∫–æ–ª&gt;-&lt;–¥–∞—Ç–∞_–∞–∫—Ç–∏–≤–∞—Ü–∏–∏–Ω&gt;.*</code>",
    },
    "gb_u_ovpn": {
        "prefix": "GL-UDP",
        "text": "‚ö° <b>–í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</b>. –ò–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤–æ–≥–æ –≤–∏–¥–µ–æ –∏ –∏–≥—Ä! üéÆüì∫ \n\n<b>FAQ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Ñ–∞–π–ª–æ–≤:</b>\n\n <code>&lt;–≤–∞—Ä–∏–∞–Ω—Ç_–≤–ø–Ω&gt;-&lt;–ø—Ä–æ—Ç–æ–∫–æ–ª&gt;-&lt;–¥–∞—Ç–∞_–∞–∫—Ç–∏–≤–∞—Ü–∏–∏–Ω&gt;.*</code>",
    },
    "gb_t_ovpn": {
        "prefix": "GL-TCP",
        "text": "üîí <b>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</b>. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –æ–±—Ö–æ–¥–∞ —Å—Ç—Ä–æ–≥–∏—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –∏ –∑–∞—â–∏—Ç—ã –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏. üîë\n\n<b>FAQ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Ñ–∞–π–ª–æ–≤:</b>\n\n <code>&lt;–≤–∞—Ä–∏–∞–Ω—Ç_–≤–ø–Ω&gt;-&lt;–ø—Ä–æ—Ç–æ–∫–æ–ª&gt;-&lt;–¥–∞—Ç–∞_–∞–∫—Ç–∏–≤–∞—Ü–∏–∏–Ω&gt;.*</code>",
    },
    "az_amneziawg": {
        "prefix": "AZ-AM",
        "text": "üïä –û—â—É—Ç–∏—Ç–µ —Å–≤–æ–±–æ–¥—É –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ c <b>—É–ª—É—á—à–µ–Ω–Ω—ã–º –º–µ—Ö–∞–Ω–∏–∑–º–æ–º —Å–∫—Ä—ã—Ç–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ VPN</b> ü•∑\n\n<b>FAQ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Ñ–∞–π–ª–æ–≤:</b>\n\n <code>&lt;–≤–∞—Ä–∏–∞–Ω—Ç_–≤–ø–Ω&gt;-&lt;–ø—Ä–æ—Ç–æ–∫–æ–ª&gt;-&lt;–¥–∞—Ç–∞_–∞–∫—Ç–∏–≤–∞—Ü–∏–∏–Ω&gt;.*</code>",
    },
    "gb_amneziawg": {
        "prefix": "GL-AM",
        "text": "üôà –í–∞—à–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –ø–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É <b>–±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫</b> –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–¥–µ—Å—å! <b>–ó–∞—â–∏—Ç–∏—Ç–µ —Å–≤–æ—é –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å</b> –∏ <b>–æ—Å—Ç–∞–≤–∞–π—Ç–µ—Å—å –∞–Ω–æ–Ω–∏–º–Ω—ã–º!</b> üïµÔ∏è‚Äç‚ôÇÔ∏è\n\n<b>FAQ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Ñ–∞–π–ª–æ–≤:</b>\n\n <code>&lt;–≤–∞—Ä–∏–∞–Ω—Ç_–≤–ø–Ω&gt;-&lt;–ø—Ä–æ—Ç–æ–∫–æ–ª&gt;-&lt;–¥–∞—Ç–∞_–∞–∫—Ç–∏–≤–∞—Ü–∏–∏–Ω&gt;.*</code>",
    },
    "az_wireguard": {
        "prefix": "AZ-WG",
        "text": "‚ö° –û–±—Ö–æ–¥–∏—Ç–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –ª—é–±–∏–º—ã–º —Å–∞–π—Ç–∞–º —Å <b>–≤—ã—Å–æ–∫–æ–π —Å–∫–æ—Ä–æ—Å—Ç—å—é</b>! üåä\n\n<b>FAQ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Ñ–∞–π–ª–æ–≤:</b>\n\n <code>&lt;–≤–∞—Ä–∏–∞–Ω—Ç_–≤–ø–Ω&gt;-&lt;–ø—Ä–æ—Ç–æ–∫–æ–ª&gt;-&lt;–¥–∞—Ç–∞_–∞–∫—Ç–∏–≤–∞—Ü–∏–∏–Ω&gt;.*</code>",
    },
    "gb_wireguard": {
        "prefix": "GL-WG",
        "text": "üîí –ü–æ–ª—É—á–∏—Ç–µ <b>–º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –∑–∞—â–∏—Ç—É –∏ –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å</b> –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞. –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–¥ –Ω–∞–¥–µ–∂–Ω–æ–π –∑–∞—â–∏—Ç–æ–π! üîê\n\n<b>FAQ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Ñ–∞–π–ª–æ–≤:</b>\n\n <code>&lt;–≤–∞—Ä–∏–∞–Ω—Ç_–≤–ø–Ω&gt;-&lt;–ø—Ä–æ—Ç–æ–∫–æ–ª&gt;-&lt;–¥–∞—Ç–∞_–∞–∫—Ç–∏–≤–∞—Ü–∏–∏–Ω&gt;.*</code>",
    },
}


@dp.callback_query(lambda call: call.data in config_texts.keys())
async def send_configs_callback(call: types.CallbackQuery) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π VPN –≤ –æ—Ç–≤–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è."""
    user_id = call.from_user.id
    user = await get_user_by_id(user_id)

    # –ü—Ä–æ–≤–µ—Ä–∫–∞, –∏–º–µ–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º
    if user and user[2] == "accepted":
        config = config_texts[call.data]  # –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø–æ –∫–ª—é—á—É
        file_type = (
            "conf" if "WG" in config["prefix"] or "AM" in config["prefix"] else "ovpn"
        )  # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —Ñ–∞–π–ª–∞
        file_prefix = config["prefix"]  # –ü–æ–ª—É—á–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å —Ñ–∞–π–ª–∞
        # –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º —Ñ–∞–π–ª–∞–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        for file in os.listdir(f"/root/vpn/n{user_id}"):
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ —Ñ–∞–π–ª –ø—Ä–µ—Ñ–∏–∫—Å—É –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é
            if file.startswith(file_prefix) and file.endswith(f".{file_type}"):
                caption = config["text"]  # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–¥–ø–∏—Å–∏
                await bot.send_document(
                    user_id,
                    FSInputFile(f"/root/vpn/n{user_id}/{file}"),
                    caption=caption,
                    parse_mode="HTML",
                )
                #
                # # –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤
                # if file_type == "ovpn":
                #     if "AZ" in config["prefix"]:
                #         await ovpn_menu_az(call, thr=1)
                #     else:
                #         await ovpn_menu_gb(call, thr=1)
                # else:
                #     if "AZ" in config["prefix"]:
                #         await protos_menu(user_id=user_id, proto="az")
                #     else:
                #         await protos_menu(user_id=user_id, proto="gb")

                break  # –ó–∞–≤–µ—Ä—à–∞–µ–º —Ü–∏–∫–ª –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–µ—Ä–≤–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ —Ñ–∞–π–ª–∞

    else:
        # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        await non_authorized(call.from_user.id, call.message.message_id)
